<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- svn-version: ${svn.version} -->
<html>
  <head>
    <title>Jamon Tutorial - 8. Template Fragments
</title>
    <meta name="keywords" content="template,templates,typed,dynamic,text,java,MVC,render,model-view-controller,typesafety,typesafe"></meta>
    <link rel="SHORTCUT ICON" href="/favicon.ico">
    <link rel="StyleSheet" href="../base.css" type="text/css" media="screen" />
  </head>

  <body>

    <div id="logo">
      <h1 id="logo1">Jamon</h1>
      <h3 id="logo2">a typed template engine for Java</h3>
    </div>

    <h3 id="tagline">
      <span class="tagline1">type</span> <span class="tagline2">safe</span> <span class="tagline3">templating</span><br />
    </h3>

    <div class="header" id="header1"><span /></div>
    <div class="header" id="header2"><span /></div>
    <div class="header" id="header3"><span /></div>
    <div class="header" id="header4"><span /></div>

    <div id="nav">
      <ul class="nav">
          <li class="nav"
    >
<a href="../index.html" >Home</a>
</li>

          <li class="nav"
    >
<a href="../Features.html" >Features</a>
</li>

          <li class="nav"
    >
<a href="../News.html" >News</a>
</li>

          <li class="nav"
    >
<a href="../Download.html" >Download</a>
</li>

          <li class="nav"
    >
<a href="../Contact.html" >Contact</a>
</li>

          <li class="nav"
    >
<a href="../About.html" >About</a>
</li>

        </ul>

        <ul class="nav">
          <li class="static">Documentation</li>
          <li class="nav"
    >
<a href="../Overview.html" >Overview</a>
</li>

          <li class="nav"
    id="current">
<a href="../tutorial/TutorialPath.html" >Tutorial</a>
</li>

          <li class="nav"
    >
<a href="../GeneratedTemplates.html" >Generated classes</a>
</li>

          <li class="nav"
    >
<a href="../UserGuide.html" >User's Guide</a>
</li>

          <li class="nav"
    >
<a href="../Ant.html" >Ant integration</a>
</li>

          <li class="nav"
    >
<a href="../Maven.html" >Maven integration</a>
</li>

          <li class="nav"
    >
<a href="../Eclipse.html" >Eclipse plugin</a>
</li>

          <li class="nav"
    >
<a href="../Servlets.html" >Servlet usage</a>
</li>

          <li class="nav"
    >
<a href="../Reference.html" >Reference manual</a>
</li>

          <li class="nav">
           <a href='../javadoc/index.html'>Javadoc</a>
          </li>
        </ul>
      </div>
      <div id="main">
        <div class="tutorialNav">
    <span class="tutorialNavNeighbor">
      
    <a href="TutorialSample7.html">Previous</a>
  

    </span>
    <span class="tutorialNavContents">
      <a href="TutorialPath.html">Tutorial contents</a>
    </span>
    <span class="tutorialNavNeighbor">
      
    <a href="TutorialSample9.html">Next</a>
  

    </span>
  </div>


<h2>Jamon Tutorial - 8. Template Fragments
</h2>

<ol>
<li> <span class="concept"> Passing fragment arguments</span>

In addition to template arguments, Jamon allows passing a block, or
"fragment," of Jamon text to a template. When passing a template
fragment, the invocation syntax must look like <nobr><code>&lt;&amp;|
target; arg1 = ... &amp;> [fragment of Jamon text] &lt;/&amp;></code></nobr>,
and any template content after the start tag, <nobr><code>&lt;&amp;| target;
arg1 = ... &amp;></code></nobr>, up to the closing tag,
<code>&lt;/&amp;></code>, is considered the fragment argument.
<p>
In this example,
<a href="FragmentCallerTemplate.jamon" class="file"><code>FragmentCallerTemplate.jamon</code></a>,
    <pre class="jamon">&lt;%args&gt;
  String userName;
&lt;/%args&gt;
&lt;%doc&gt;Output list of links&lt;/%doc&gt;
Site map:&lt;br&gt;
&lt;ul&gt;
&lt;&amp;| liRef; href = "/about.html" &amp;&gt;About this company &lt;/&amp;&gt;
&lt;&amp;| liRef; href = "/privacy.html" &amp;&gt;We protect your information &lt;/&amp;&gt;
&lt;&amp;| liRef; href = "/stores.html" &amp;&gt;Find the store nearest you! &lt;/&amp;&gt;
&lt;%if userName != null %&gt;
  &lt;&amp;| liRef; href = "/accountInfo.html" &amp;&gt;
    Account information for &lt;% userName %&gt;
  &lt;/&amp;&gt;
&lt;/%if&gt;
&lt;/ul&gt;

&lt;%def liRef&gt;
  &lt;%frag content/&gt;
  &lt;%args&gt;
    String href;
  &lt;/%args&gt;
  &lt;li&gt;&lt;a href="&lt;% href %&gt;"&gt;&lt;&amp; content &amp;&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/%def&gt;
</pre>


the block of HTML text "<code>Account information for &lt;% userName %></code>"
is passed to the subtemplate <code>liRef</code>, which constructs a list
item with an HTML anchor using the fragment text as the anchor text.

<p> In this example the text passed to the subtemplate
includes an emit statement, <code>&lt;% userName %></code>. This emit
statement is evaluated in the subtemplate. The subtemplate has access
to all arguments passed to the calling template as well as final and
class scope fields in the calling template. Unfortunately, however,
any <em>non-final</em> variable declared in the Jamon text will
<em>not</em> be visible to the called template that evaluates the
template fragment.

<p>
The advantage of framgments is that the author can compose the text to
display in the main template, but then pass that text to another
template to process. In this example, the author specifies the text to
include in the link, but passes the text to a subtemplate to encapsulate
in the HTML tags required to build the link.

<div class="note">
A template fragment is translated by Jamon into an <em>inner</em> class of
the template that contains the fragment text. This means that the
<strong>only</strong> variables in the containing template that can be
accessed by fragment text are
<ul><li>
        class scope variables declared within <code>&lt;%class>&lt;/%class></code> tags
<li>
        final variables and arguments to the template. (Note that all
        arguments to the template are implemented as <code>final</code>
        fields in the translated Java class and, hence, are visible
        to inner classes.)
</ul>
</div>

<li> <span class="concept"> Accepting fragment arguments</span>

A template declares that it accepts template fragments by including
the <code>&lt;%frag <em>fragmentName</em>/&gt;</code> tag. The
<code><em>fragmentName</em></code> argument is the name of the
fragment template. The template that accepts the fragment
calls the fragment as it would any other template to output its contents.
<p>
The template below, <a href="LiRef.jamon" class="file"><code>LiRef.jamon</code></a>, is a more elaborate version of the
subtemplate in the above example.
    <pre class="jamon">&lt;%frag content/&gt;
&lt;%args&gt;
  String href;
  String style = null;
&lt;/%args&gt;
&lt;li&gt;
  &lt;a href="&lt;% href %&gt;"&lt;%if style != null %&gt; class="&lt;% style %&gt;"&lt;/%if&gt;&gt;&lt;&amp; content &amp;&gt;&lt;/a&gt;
&lt;/li&gt;
</pre>


It formats the <code>content</code> fragment text with the specified
stylesheet style as an HTML anchor inside a list item.

<li><span class="concept">Parameterized Template Fragments</span>
A template fragment is a template and can have arguments just like a template.
<p>
To add arguments to a fragment, simply include a
<nobr><code>&lt;%args></code> ... <code>&lt;/%args></code></nobr>
tag at the beginning of the fragment.
<pre class="jamon">
&lt;%java DateFormat dateFormat = new SimpleDateFormat("MM/dd"); %&gt;
We offer the following holidays:
&lt;&amp;| AlternatingList; items = holidays.iterator() &amp;&gt;
  &lt;%args&gt;
    Object holidayObj;
  &lt;/%args&gt;
  Holiday holiday = (Holiday) holidayObj;
  &lt;td&gt;&lt;% dateFormat.format(holiday.getDate()) %&gt;&lt;/td&gt;
  &lt;td&gt;&lt;% holiday.getName() %&gt;&lt;/td&gt;
&lt;/&amp;&gt;
</pre>

This fragment expects a single <code>holidayObj</code>
argument to be provided each time it is invoked.

<div class="note">
The signature of the arguments to the fragment, that is the types
of the arguments and their order, must match the signature
of the fragment arguments as defined in the template that
accepts the fragment.
</div>

<p>
To declare a template that expects a fragment with arguments,
just add parameters within the
<nobr><code>&lt;%frag name> <em> parameters </em> &lt;/%frag></code></nobr>
tag.
Thus
      a <nobr><code>&lt;%frag
      name&gt;</code>...<code>&lt;/%frag&gt;</code></nobr> is similar
      to a
      <nobr><code>&lt;%args&gt;</code>...<code>&lt;/%args&gt;</code></nobr>
      except it has a name and its parameters <strong>cannot</strong>
       have default values.

    <pre class="jamon">&lt;%import&gt;
  java.util.Iterator;
&lt;/%import&gt;
&lt;%frag content&gt;
  Object renderable;
&lt;/%frag&gt;
&lt;%args&gt;
  Iterator items;
&lt;/%args&gt;
&lt;%java int row = 0; %&gt;
&lt;table&gt;
&lt;%while items.hasNext() %&gt;
    &lt;tr bgcolor="&lt;% row++ % 2 == 0 ? "white" : "grey" %&gt;"&gt;
      &lt;&amp; content; renderable = items.next() &amp;&gt;
    &lt;/tr&gt;
&lt;/%while&gt;
&lt;/table&gt;
</pre>


This template, <a href="AlternatingList.jamon" class="file"><code>AlternatingList.jamon</code></a>,
loops through all the objects that were passed to
it by the <nobr><code>items Iterator</code></nobr>,
and assigns each one in turn to the fragment parameter
<code>renderable</code> when it calls the template fragment.
By using a template fragment, <code>AlternatingList</code> can
format a table to have rows with alternating background colors
and yet can execute the fragment's block of Jamon code
to fill in each row.
<p>
<li><span class="concept">A Template Fragment Example</span>

The template <a href="FragmentExampleTemplate.jamon" class="file"><code>FragmentExampleTemplate.jamon</code></a>, below,
produces a table listing the name and date of the holidays recognized by the
template author. The template formats the row it would like to see for each
line of output, and then passes this fragment of Jamon text to the
<code>AlternatingList</code> template to format into a
table with alternating background colors.
<p>

    <pre class="jamon">&lt;%import&gt;
  java.text.DateFormat;
  java.text.SimpleDateFormat;
  java.util.List;
  java.util.Iterator;
&lt;/%import&gt;

&lt;%args&gt;
  List holidays;
&lt;/%args&gt;

&lt;%doc&gt;
dateFormat MUST be declared final so the fragment can access it.
&lt;/%doc&gt;
&lt;%java final DateFormat dateFormat = new SimpleDateFormat("MM/dd"); %&gt;
We offer the following holidays:
&lt;&amp;| AlternatingList; items = holidays.iterator() &amp;&gt;
  &lt;%args&gt;
    Object holidayObj;
  &lt;/%args&gt;
&lt;%java  Holiday holiday = (Holiday) holidayObj; %&gt;
  &lt;td&gt;&lt;% holiday.getName() %&gt;&lt;/td&gt;
  &lt;td&gt;&lt;% dateFormat.format(holiday.getDate()) %&gt;&lt;/td&gt;
&lt;/&amp;&gt;
</pre>


<p>
The example template is executed by the
<a href="Holiday.java" class="file"><code>Holiday.java</code></a> Java class.
<pre class="java">import java.io.OutputStreamWriter;
import java.util.List;
import java.util.ArrayList;
import java.util.Date;
import java.text.DateFormat;
import java.text.SimpleDateFormat;

public class Holiday {
  private Date date;
  private String name;

  static private DateFormat format = new SimpleDateFormat("yyyy-MM-dd");

  public Holiday (String p_name, Date p_date) {
    name = p_name;
    date = p_date;
  }

  public String getName() { return  name; }
  public Date getDate() { return  date; }

  public static void main(String[] argv) throws Exception {
    List&lt;Holiday&gt; holidays = new ArrayList&lt;Holiday&gt;();
    holidays.add(new Holiday("New Year's", format.parse("2003-1-1")));
    holidays.add(new Holiday("July 4", format.parse("2003-7-4")));
    holidays.add(new Holiday("Thanksgiving", format.parse("2003-11-17")));
    holidays.add(new Holiday("Christmas", format.parse("2003-12-25")));
    new FragmentExampleTemplate()
      .render(new OutputStreamWriter(System.out), holidays);
  }
}
</pre>

<p>
The output from the template is
<pre class="tty">
We offer the following holidays:
&lt;table&gt;

    &lt;tr bgcolor="white"&gt;
      
  &lt;td&gt;New Year's&lt;/td&gt;
  &lt;td&gt;01/01&lt;/td&gt;

    &lt;/tr&gt;

    &lt;tr bgcolor="grey"&gt;
      
  &lt;td&gt;July 4&lt;/td&gt;
  &lt;td&gt;07/04&lt;/td&gt;

    &lt;/tr&gt;

    &lt;tr bgcolor="white"&gt;
      
  &lt;td&gt;Thanksgiving&lt;/td&gt;
  &lt;td&gt;11/17&lt;/td&gt;

    &lt;/tr&gt;

    &lt;tr bgcolor="grey"&gt;
      
  &lt;td&gt;Christmas&lt;/td&gt;
  &lt;td&gt;12/25&lt;/td&gt;

    &lt;/tr&gt;

&lt;/table&gt;

</pre>


</ol>

<div class="tutorialNav">
    <span class="tutorialNavNeighbor">
      
    <a href="TutorialSample7.html">Previous</a>
  

    </span>
    <span class="tutorialNavContents">
      <a href="TutorialPath.html">Tutorial contents</a>
    </span>
    <span class="tutorialNavNeighbor">
      
    <a href="TutorialSample9.html">Next</a>
  

    </span>
  </div>





      </div>

    <div id="logo">
    <h1 id="logo1">Jamon</h1>
    <h3 id="logo2">a typed template engine for Java</h3>
    </div>


  </body>
</html>

