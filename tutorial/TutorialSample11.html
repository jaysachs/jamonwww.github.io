<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- svn-version: ${svn.version} -->
<html>
  <head>
    <title>Jamon Tutorial - 11. Jamon Context: Providing data to all templates at once
</title>
    <meta name="keywords" content="template,templates,typed,dynamic,text,java,MVC,render,model-view-controller,typesafety,typesafe"></meta>
    <link rel="SHORTCUT ICON" href="/favicon.ico">
    <link rel="StyleSheet" href="../base.css" type="text/css" media="screen" />
  </head>

  <body>

    <div id="logo">
      <h1 id="logo1">Jamon</h1>
      <h3 id="logo2">a typed template engine for Java</h3>
    </div>

    <h3 id="tagline">
      <span class="tagline1">type</span> <span class="tagline2">safe</span> <span class="tagline3">templating</span><br />
    </h3>

    <div class="header" id="header1"><span /></div>
    <div class="header" id="header2"><span /></div>
    <div class="header" id="header3"><span /></div>
    <div class="header" id="header4"><span /></div>

    <div id="nav">
      <ul class="nav">
          <li class="nav"
    >
<a href="../index.html" >Home</a>
</li>

          <li class="nav"
    >
<a href="../Features.html" >Features</a>
</li>

          <li class="nav"
    >
<a href="../News.html" >News</a>
</li>

          <li class="nav"
    >
<a href="../Download.html" >Download</a>
</li>

          <li class="nav"
    >
<a href="../Contact.html" >Contact</a>
</li>

          <li class="nav"
    >
<a href="../About.html" >About</a>
</li>

        </ul>

        <ul class="nav">
          <li class="static">Documentation</li>
          <li class="nav"
    >
<a href="../Overview.html" >Overview</a>
</li>

          <li class="nav"
    id="current">
<a href="../tutorial/TutorialPath.html" >Tutorial</a>
</li>

          <li class="nav"
    >
<a href="../GeneratedTemplates.html" >Generated classes</a>
</li>

          <li class="nav"
    >
<a href="../UserGuide.html" >User's Guide</a>
</li>

          <li class="nav"
    >
<a href="../Ant.html" >Ant integration</a>
</li>

          <li class="nav"
    >
<a href="../Maven.html" >Maven integration</a>
</li>

          <li class="nav"
    >
<a href="../Eclipse.html" >Eclipse plugin</a>
</li>

          <li class="nav"
    >
<a href="../Servlets.html" >Servlet usage</a>
</li>

          <li class="nav"
    >
<a href="../Reference.html" >Reference manual</a>
</li>

          <li class="nav">
           <a href='../javadoc/index.html'>Javadoc</a>
          </li>
        </ul>
      </div>
      <div id="main">
        <div class="tutorialNav">
    <span class="tutorialNavNeighbor">
      
    <a href="TutorialSample10.html">Previous</a>
  

    </span>
    <span class="tutorialNavContents">
      <a href="TutorialPath.html">Tutorial contents</a>
    </span>
    <span class="tutorialNavNeighbor">
      
    &nbsp;
  

    </span>
  </div>


<h2>Jamon Tutorial - 11. Jamon Context: Providing data to all templates at once
</h2>

All of the examples of dynamic content in templates that we've seen up until now have involved data 
that is passed in explicitely to a template.  However, certain kinds of information don't "want" to
be passed around as arguments from template to template.  For example, suppose you have a utility 
template to generate your site's logo.  Since some pages on your site might be accessed with either 
the <code>http:</code> or <code>https:</code> protocols, you want your image template to be able to
generate either insecure or secure image urls, depending on the way the page is being accessed.
As a first stab at this, you might write a template looking something like:

<pre class="jamon">
&lt;%args&gt;
  boolean secure;
&lt;/%args&gt;
&lt;img href="http&lt;%if secure %&gt;s&lt;/%if&gt;://myhost.myorg.com/logo.jpg"/&gt;
</pre>


Unfortunately, now every component calling this template must be able to tell it whether the page
is secure or not.  If your site is well factored, you will likely have components calling those 
components as well, and all of them will need to know about security.

<p>

A better solution is to keep track of whether or not the page is secure by using the 
<code>jamonContext</code> variable.  This is a special variable which can be made available to
every template in your site, and will automatically be passed between them. To use 
<code>jamonContext</code>, you first must declare it's type.  Since the type will need to be the
same accross a number of templates, rather than declaring it in the body of a particular template
(or requiring every template to declare it), the type is declared by setting the 
<code>org.jamon.contextType</code> property in a special file named <code>jamon.properties</code>;
placing this in your templates directory will give every template a jamonContext variable of the
specified type.  The proxy classes will get an additional method, <code>setJamonContext()</code> 
which you can use to set the context.

<h3>An Example</h3>

<ol>
  <li>
    Create a java class for context, <a href="MyContext.java" class="file"><code>MyContext.java</code></a>:
    <pre class="java">public class MyContext {
  private boolean secure;

  public boolean isSecure() {
    return secure;
  }
  
  public void setSecure(boolean secure) {
    this.secure = secure; 
  }
}
</pre>

  </li>
  <li>
    Create a file <a href="jamon.properties" class="file"><code>jamon.properties</code></a> in your template directory:
    <pre class="properties">org.jamon.contextType = MyContext
</pre>

  </li>
  <li>
    Create <a href="Logo.jamon" class="file"><code>Logo.jamon</code></a>:
    <pre class="jamon">&lt;img href="http&lt;%if jamonContext.isSecure() %&gt;s&lt;/%if&gt;://logo.jpg"/&gt;
</pre>

  </li>
  <li>
    Create <a href="WelcomeTemlpate.jamon" class="file"><code>WelcomeTemlpate.jamon</code></a>:
    <pre class="jamon">&lt;html&gt;
  &lt;body&gt;
    &lt;&amp; Logo &amp;&gt; Welcome to our site!
  &lt;/body&gt;
&lt;/html&gt;
</pre>

  </li>
  <li>
    Call this template from the Java class, <a href="WelcomeTut11.java" class="file"><code>WelcomeTut11.java</code></a>:
    <pre class="java">import java.io.OutputStreamWriter;

public class WelcomeTut11 {
  public static void main(String[] argv) throws Exception {
    MyContext context = new MyContext();
    context.setSecure(true);
    new WelcomeTemplate()
      .setJamonContext(context)
      .render(new OutputStreamWriter(System.out));
  }
}
</pre>

  </li>
  <li>
    The output should be
    <pre class="tty">
&lt;html&gt;
  &lt;body&gt;
    &lt;img href="https://logo.jpg"/&gt; Welcome to our site!
  &lt;/body&gt;
&lt;/html&gt;</pre>

  </li>
</ol>

<h3>Best Practices</h3>
For those coming from the JSP world, it might be tempting to use the <code>jamonContext</code>
in the same way as attributes on the <code>HTTPServletRequest</code> instance are used in JSP pages.
As a general rule, it's best passing data via <code>&lt;%args&gt;</code> blocks; 
<code>jamonContext</code> should be reserved for exceptional cases such as the one described above,
or locale information, which span the context of an entire application.

<p>
For writers of jamon template libraries who wish to make use of the <code>jamonContext</code> 
variable, it is strongly encouraged that they choose a Java interface for the context variable type.
This will clients to provide an implementation of that interface which
also provides other data needed for client-specific applications.

<div class="tutorialNav">
    <span class="tutorialNavNeighbor">
      
    <a href="TutorialSample10.html">Previous</a>
  

    </span>
    <span class="tutorialNavContents">
      <a href="TutorialPath.html">Tutorial contents</a>
    </span>
    <span class="tutorialNavNeighbor">
      
    &nbsp;
  

    </span>
  </div>





      </div>

    <div id="logo">
    <h1 id="logo1">Jamon</h1>
    <h3 id="logo2">a typed template engine for Java</h3>
    </div>


  </body>
</html>

